<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game - React</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-600 to-indigo-800 min-h-screen flex justify-center items-center p-4">
    <div id="root" class="w-full max-w-2xl"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        // Game constants
        const GRID_SIZE = 20;
        const TILE_COUNT = 20;
        const INITIAL_SPEED = 150;
        
        // Direction constants
        const DIRECTIONS = {
            UP: { x: 0, y: -1 },
            DOWN: { x: 0, y: 1 },
            LEFT: { x: -1, y: 0 },
            RIGHT: { x: 1, y: 0 }
        };
        
        // Game component
        function SnakeGame() {
            const [snake, setSnake] = useState([
                {x: 10, y: 10},
                {x: 9, y: 10},
                {x: 8, y: 10}
            ]);
            
            const [food, setFood] = useState({x: 15, y: 15});
            const [direction, setDirection] = useState(DIRECTIONS.RIGHT);
            const [nextDirection, setNextDirection] = useState(DIRECTIONS.RIGHT);
            const [score, setScore] = useState(0);
            const [gameRunning, setGameRunning] = useState(false);
            const [gameOver, setGameOver] = useState(false);
            const [speed, setSpeed] = useState(INITIAL_SPEED);
            
            // Generate food at random position
            const generateFood = useCallback(() => {
                let newFood;
                let onSnake;
                
                do {
                    onSnake = false;
                    newFood = {
                        x: Math.floor(Math.random() * TILE_COUNT),
                        y: Math.floor(Math.random() * TILE_COUNT)
                    };
                    
                    // Check if food is on snake
                    for (let segment of snake) {
                        if (segment.x === newFood.x && segment.y === newFood.y) {
                            onSnake = true;
                            break;
                        }
                    }
                } while (onSnake);
                
                setFood(newFood);
            }, [snake]);
            
            // Initialize game
            const initGame = useCallback(() => {
                setSnake([
                    {x: 10, y: 10},
                    {x: 9, y: 10},
                    {x: 8, y: 10}
                ]);
                
                setDirection(DIRECTIONS.RIGHT);
                setNextDirection(DIRECTIONS.RIGHT);
                setScore(0);
                setGameOver(false);
                setSpeed(INITIAL_SPEED);
                generateFood();
            }, [generateFood]);
            
            // Handle keyboard input
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if ([37, 38, 39, 40].includes(e.keyCode)) {
                        e.preventDefault();
                    }
                    
                    switch(e.key) {
                        case 'ArrowUp':
                            if (direction.y === 0) {
                                setNextDirection(DIRECTIONS.UP);
                            }
                            break;
                        case 'ArrowDown':
                            if (direction.y === 0) {
                                setNextDirection(DIRECTIONS.DOWN);
                            }
                            break;
                        case 'ArrowLeft':
                            if (direction.x === 0) {
                                setNextDirection(DIRECTIONS.LEFT);
                            }
                            break;
                        case 'ArrowRight':
                            if (direction.x === 0) {
                                setNextDirection(DIRECTIONS.RIGHT);
                            }
                            break;
                        case 'r':
                        case 'R':
                            initGame();
                            break;
                    }
                };
                
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [direction, initGame]);
            
            // Game loop
            useEffect(() => {
                if (!gameRunning || gameOver) return;
                
                const moveSnake = () => {
                    setDirection(nextDirection);
                    
                    setSnake(prevSnake => {
                        const head = {x: prevSnake[0].x + nextDirection.x, y: prevSnake[0].y + nextDirection.y};
                        
                        // Check collision with walls
                        if (head.x < 0 || head.x >= TILE_COUNT || head.y < 0 || head.y >= TILE_COUNT) {
                            setGameOver(true);
                            setGameRunning(false);
                            return prevSnake;
                        }
                        
                        // Check collision with self
                        for (let i = 0; i < prevSnake.length; i++) {
                            if (head.x === prevSnake[i].x && head.y === prevSnake[i].y) {
                                setGameOver(true);
                                setGameRunning(false);
                                return prevSnake;
                            }
                        }
                        
                        const newSnake = [head, ...prevSnake];
                        
                        // Check if food is eaten
                        if (head.x === food.x && head.y === food.y) {
                            setScore(prev => prev + 10);
                            
                            // Increase speed slightly with each food eaten
                            if (speed > 50) {
                                setSpeed(prev => prev - 2);
                            }
                            
                            generateFood();
                        } else {
                            newSnake.pop();
                        }
                        
                        return newSnake;
                    });
                };
                
                const gameInterval = setInterval(moveSnake, speed);
                return () => clearInterval(gameInterval);
            }, [gameRunning, gameOver, nextDirection, food, speed, generateFood]);
            
            // Start game
            const startGame = () => {
                if (!gameRunning) {
                    setGameRunning(true);
                    setGameOver(false);
                }
            };
            
            // Toggle pause/resume
            const togglePause = () => {
                if (gameRunning) {
                    setGameRunning(false);
                } else {
                    if (snake.length > 0 && !gameOver) {
                        setGameRunning(true);
                    }
                }
            };
            
            // Reset game
            const resetGame = () => {
                initGame();
                setGameRunning(false);
            };
            
            // Restart after game over
            const restartGame = () => {
                initGame();
                setGameRunning(true);
            };
            
            // Handle virtual D-pad buttons
            const handleDirectionChange = (newDirection) => {
                if (
                    (newDirection.x !== 0 && direction.x === 0) ||
                    (newDirection.y !== 0 && direction.y === 0)
                ) {
                    setNextDirection(newDirection);
                }
            };
            
            // Render game cell
            const renderCell = (x, y) => {
                // Check if this cell is part of the snake
                const isSnakeHead = snake[0].x === x && snake[0].y === y;
                const isSnakeBody = snake.slice(1).some(segment => segment.x === x && segment.y === y);
                
                // Check if this cell is food
                const isFood = food.x === x && food.y === y;
                
                let cellClass = "w-4 h-4 border border-gray-800 ";
                
                if (isSnakeHead) {
                    cellClass += "bg-green-500 rounded-sm";
                } else if (isSnakeBody) {
                    cellClass += "bg-green-400 rounded-sm";
                } else if (isFood) {
                    cellClass += "bg-red-500 rounded-full animate-pulse";
                } else {
                    cellClass += "bg-gray-900";
                }
                
                return (
                    <div key={`${x}-${y}`} className={cellClass}></div>
                );
            };
            
            // Create game grid
            const renderGrid = () => {
                const grid = [];
                
                for (let y = 0; y < TILE_COUNT; y++) {
                    for (let x = 0; x < TILE_COUNT; x++) {
                        grid.push(renderCell(x, y));
                    }
                }
                
                return grid;
            };
            
            // Render D-pad buttons
            const renderDpad = () => (
                <div className="mt-6 flex justify-center">
                    <div className="flex flex-col items-center gap-3">
                        <div className="flex justify-center gap-3">
                            <button 
                                onClick={() => handleDirectionChange(DIRECTIONS.UP)}
                                className="w-12 h-12 bg-white/80 rounded-full flex items-center justify-center text-xl font-bold hover:bg-white transition-all active:scale-95 shadow-lg"
                            >
                                ↑
                            </button>
                        </div>
                        <div className="flex justify-center gap-3">
                            <button 
                                onClick={() => handleDirectionChange(DIRECTIONS.LEFT)}
                                className="w-12 h-12 bg-white/80 rounded-full flex items-center justify-center text-xl font-bold hover:bg-white transition-all active:scale-95 shadow-lg"
                            >
                                ←
                            </button>
                            <button 
                                onClick={() => handleDirectionChange(DIRECTIONS.DOWN)}
                                className="w-12 h-12 bg-white/80 rounded-full flex items-center justify-center text-xl font-bold hover:bg-white transition-all active:scale-95 shadow-lg"
                            >
                                ↓
                            </button>
                            <button 
                                onClick={() => handleDirectionChange(DIRECTIONS.RIGHT)}
                                className="w-12 h-12 bg-white/80 rounded-full flex items-center justify-center text-xl font-bold hover:bg-white transition-all active:scale-95 shadow-lg"
                            >
                                →
                            </button>
                        </div>
                    </div>
                </div>
            );
            
            return (
                <div className="bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl p-6 w-full max-w-md">
                    <h1 className="text-3xl font-bold text-center mb-2 text-gray-800">Snake Game</h1>
                    <p className="text-center text-gray-600 mb-4">Use arrow keys or D-pad to control the snake</p>
                    
                    <div className="flex justify-between items-center mb-4">
                        <div className="text-xl font-semibold text-gray-800">Score: {score}</div>
                        <div className="text-sm bg-blue-100 px-3 py-1 rounded-full text-blue-800">
                            Speed: {Math.round((INITIAL_SPEED - speed + 50) / 10)}
                        </div>
                    </div>
                    
                    <div 
                        className="grid grid-cols-20 gap-0 border-4 border-gray-800 rounded-lg overflow-hidden mx-auto bg-gray-900"
                        style={{ width: '400px', height: '400px' }}
                    >
                        {renderGrid()}
                    </div>
                    
                    <div className="flex flex-wrap justify-center gap-3 mt-6">
                        <button 
                            onClick={startGame}
                            disabled={gameRunning && !gameOver}
                            className={`px-5 py-2 rounded-lg font-medium transition-all ${
                                gameRunning && !gameOver 
                                    ? 'bg-gray-400 cursor-not-allowed' 
                                    : 'bg-green-500 hover:bg-green-600 text-white'
                            }`}
                        >
                            {gameOver ? 'Start Game' : 'Resume'}
                        </button>
                        
                        <button 
                            onClick={togglePause}
                            disabled={!gameRunning && !gameOver}
                            className={`px-5 py-2 rounded-lg font-medium transition-all ${
                                gameRunning 
                                    ? 'bg-yellow-500 hover:bg-yellow-600 text-white' 
                                    : 'bg-gray-400 cursor-not-allowed'
                            }`}
                        >
                            {gameRunning ? 'Pause' : 'Resume'}
                        </button>
                        
                        <button 
                            onClick={resetGame}
                            className="px-5 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-all"
                        >
                            Reset
                        </button>
                    </div>
                    
                    {/* D-pad for mobile */}
                    <div className="md:hidden mt-6">
                        {renderDpad()}
                    </div>
                    
                    {/* Game Over Modal */}
                    {gameOver && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-10">
                            <div className="bg-white rounded-xl p-8 text-center max-w-sm w-full shadow-2xl transform animate-pop-in">
                                <h2 className="text-2xl font-bold mb-3 text-gray-800">Game Over!</h2>
                                <p className="text-lg mb-4 text-gray-600">Your score: <span className="font-bold">{score}</span></p>
                                <button 
                                    onClick={restartGame}
                                    className="px-5 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all transform hover:scale-105"
                                >
                                    Play Again
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        
        // Render the app
        ReactDOM.render(<SnakeGame />, document.getElementById('root'));
    </script>
</body>
</html>
